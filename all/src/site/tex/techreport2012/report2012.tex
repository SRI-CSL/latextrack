\documentclass[draft,final]{report}

% ----- useful packages
\usepackage[letterpaper,verbose,pdftex]{geometry}
\usepackage{graphicx} % for including figures
\usepackage{rotating} % for landscape figure
\usepackage{tikz} % for portable graphics
\usepackage[simplified,school]{pgf-umlcd} % for UML class diagrams
\usepackage{amsmath} % align and other math constructs
\usepackage{amssymb} % math symbols
\usepackage{amsthm}
\usepackage{appendix}
\usepackage{listings} % for line-wrapping source code
\usepackage{ulem} % for strike-out font
\usepackage{booktabs} % tables in publication quality
\usepackage[strict]{changepage} % to let floating table protrude into left margin
\usepackage{multirow} % for cells spanning multiple rows in tables
\usepackage{fancyhdr}
\usepackage{fancyvrb,courier} % for more elaborate verbatim envs 
                              % (and bold-face fonts)
\usepackage[parfill]{parskip} % paragraphs begin with empty line rather than indent
\usepackage{setspace} % uncomment below to double-space for editing
\usepackage{url} % for typesetting URL's
%\usepackage[pdftex]{thumbpdf} % for thumbnails in PDF: run thumbpdf perlscript
\usepackage{color}
%\definecolor{mylinkcolor}{rgb}{0,0,0.5}
\usepackage[pdftex, % driver
  hyperfootnotes=false, % if using "footnotes" package
  colorlinks=false, % don't color links
  bookmarks=true,bookmarksnumbered=true, % show numbered bookmarks
  pdfsubject={},pdftitle={},pdfauthor={} % document info
]{hyperref} % more hyperlinks in PDF
%\usepackage{pdfpages} % to include coverpage generated from Word
\usepackage{minitoc}
\usepackage{ifdraft} % to avoid recompiling some heavy TiKZ pictures


%% header and footer on every page
\fancypagestyle{plain}{% 
 \fancyhf{} % clear all header and footer fields
% \fancyhead[L]{\small SRI International Proposal \\ ECU 09-445}
 \fancyhead[R]{\leftmark} 
 \fancyfoot[R]{\small \textcopyright\ 2012 SRI International}
 \addtolength{\headheight}{\baselineskip} 
 \renewcommand{\headrulewidth}{0.4pt} 
 \renewcommand{\footrulewidth}{0.4pt}} 
\pagestyle{plain}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter\ #1}{}}

%% AMS LaTeX definitions:
\newtheorem{defi}{Definition}
\newtheorem{lem}{Lemma}

%% customize source code output
\fvset{fontsize=\footnotesize}
\definecolor{keyword}{gray}{0.75}
\lstset{%
basicstyle=\scriptsize\ttfamily,
breaklines=true,
breakindent=0pt,
breakatwhitespace=true,
frame=lines,
fancyvrb=false,
morefvcmdparams=\textcolor 2,
columns=fullflexible,
numbers=left,
numberstyle=\tiny,
keywordstyle=\color{keyword}\bfseries}
\lstloadlanguages{C,[LaTeX]TeX,Java}
\lstdefinestyle{Java}{%
basicstyle=\tiny\ttfamily,numbers=left,numberstyle=\tiny,stepnumber=2,language=Java}
\lstdefinestyle{API}{%
language=Java,numbers=none}
\renewcommand{\lstlistlistingname}{List of Listings} % fit heading with standard ones

%% version string
\newcommand{\version}{}
\input{version.txt}

%% TiKZ settings:
\usetikzlibrary{shapes,positioning,calc}
% custom space shape:
\makeatletter
\pgfdeclareshape{myspace}{
  \inheritsavedanchors[from=rectangle]%
  \inheritanchorborder[from=rectangle]%
  \inheritanchor[from=rectangle]{center}%
  \foreach \anchor in {north,north west,north east,center,west,east,mid,
    mid west,mid east,base,base west,base east,south,south west,south east}{%
    \inheritanchor[from=rectangle]{\anchor}}
  \backgroundpath{%
    % store lower right in xa/ya and lower right in xb/yb
    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    % calculate tick length as 1/4 of side
    \pgfmathsetlength{\pgf@yc}{.75\pgf@ya+.25\pgf@yb}
    % construct path 
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@yc}}
    \pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@ya}}    
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yc}}
    \pgfusepath{stroke}
  }
}
\makeatother
% lexemes
\newcommand{\lexemesize}{2.5mm}  % default lexeme size
\tikzset{%
  font=\scriptsize,every label/.style = {inner sep=0pt},
  baseline=(current bounding box.center)}
\tikzset{match/.style = {rectangle,minimum size=#1,draw=black!70,fill=black!40}}
\tikzset{match/.default = \lexemesize}
\tikzset{diff/.style = {rectangle,minimum size=#1,draw=black!70}}
\tikzset{diff/.default = \lexemesize}
\tikzstyle{space} = [myspace,minimum size=\lexemesize,draw=black!70]
% macro for drawing multiple lexemes:
\newcommand{\lexemes}[1]{%
  \node (A) [match] {};
  \xdef\lastx{A}
  \foreach \x/\shp/\lbl/\d in {#1} {
    \node (\x) [\shp,label=center:\lbl,right=\d of \lastx] {};
    \xdef\lastx{\x}  
  }
}
% macro for drawing the diff lexemes:  TODO: fix vertical alignment to center!
\newcommand{\difflexemes}[2]{%
  \begin{tikzpicture}[node distance=0.08 and 0.05,row sep=1mm]
    \matrix {%
      \node[anchor=center,inner sep=0pt]{
        \tikz{%
          \lexemes{#1}}}; \\
      \node[anchor=center,inner sep=0pt]{
        \tikz{%
          \lexemes{#2}}}; \\
    };
  \end{tikzpicture}
}
% macro for drawing the change lexemes:
\newcommand{\changelexemes}[2]{%
  \begin{tikzpicture}[node distance=0.05]
    \lexemes{#1}
    % markup:
    \foreach \pS/\pE/\d/\loc in {#2} {
      \node (p1) [coordinate,\loc=\d of \pS.south west] {};
      \node (p2) [coordinate,\loc=\d of \pE.south east] {};
      \draw [red] (p1) -- (p2);
    }
  \end{tikzpicture}
}

% ----- title information
\title{The \LaTeX{} Track Changes System \\ {\large Technical Report}}
\author{%
Linda Briesemeister, Grit Denker, Peter Karp\\
\texttt{firstname.lastname@sri.com}\\
SRI International
}
\date{\today} 

\begin{document}
\maketitle
%{\pagestyle{empty}\cleardoublepage} % uncomment for empty page after title
%\doublespace % uncomment for editing

\dominitoc
\tableofcontents
%\listoftables
%\listoffigures
%\lstlistoflistings

\chapter{Introduction}

\input{versioning}
\input{latexdiff}

\chapter{The Accumulate() Algorithm}

\chapter{Application Programmin Interface (API)}

% ----- references 
%
\bibliographystyle{plain} 
\bibliography{./ltc}
\addcontentsline{toc}{chapter}{Bibliography} 

% ----- appendix
%
\appendix

\input{examples}% example files

\end{document}     