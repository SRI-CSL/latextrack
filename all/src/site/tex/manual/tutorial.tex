\chapter{Tutorial} \label{ch:tutorial}

This tutorial uses an example git repository called ``independence.bundle,'' which can be downloaded from the \hlink{\baseurl download.html}{../../download.html}{LTC web site.}

\section{Creating an Example Git Repository}

First, save the bundled repository into a directory of your choice.  We call this directory \Code{\$TUTORIAL}.  Then, clone from this bundle to obtain a valid git working tree.
\begin{CodeVerbatim}
$> cd $TUTORIAL
$> git clone independence.bundle independence
Cloning into independence...
$> cd independence/
$> git status
# On branch master
nothing to commit (working directory clean)
$> git log --oneline
d3f904c sixth version
203e0ce fifth version
36eeab0 fourth version
fa2be39 third version
bac2f51 second version
d6d1cf8 first version
\end{CodeVerbatim}

Now we impersonate John Adams to work on this writing project for the Declaration of Independence.

\begin{CodeVerbatim}
$> git config --add user.name "John Adams"
$> git config --add user.email "adams@usa.gov"
$> git config --list | grep dams
user.name=John Adams
user.email=adams@usa.gov
\end{CodeVerbatim}

Another way to investigate the current git repository are graphical tools such as gitx under Mac OS X.  Note that gitx is not rquired to run LTC.  Figure~\ref{fig:gitx-screen} for using gitx on the just created repository.
\begin{figure}[t]
\centering
\mygraphics{width=\textwidth,height=.5\textheight,keepaspectratio}{figures/gitx-screen}
\caption{Investigating git repository with a graphical tool} \label{fig:gitx-screen}
\end{figure}
The other point to note here is the way that gitx displays the changes in the file \Code{independence.tex} when using the graphical git interface.  It shows the lines in the file that have changed (much like a standard Unix diff would) -- however, when looking at changes in LaTeX source code, the granularity of the line-based difference is much too coarse.  An author would most likely only care about the change in words of line 15 or even characters such as removing the mistaken `d' in the word ``Roger'' on line seven.

\section{Running the LTC Editor}

Now that we are comfortable with the git repository, let us start the LTC Editor to interact with LTC and track the changes of the file.  Assume you have saved the jar file as \Code{\$LTC/LTC-\version.jar}, we can look at the command line options of the editor:
\begin{CodeVerbatim}[commandchars=\\\{\}]
$> java -cp $LTC/LTC-\version.jar com.sri.ltc.editor.LTCEditor -h
usage: java -cp ... com.sri.ltc.editor.LTCEditor [options...] [FILE] 
with
 FILE     : load given file to track changes
 -h       : display usage and exit
 -l LEVEL : set console log level
            SEVERE, WARNING, INFO, CONFIG (default), FINE, FINER, FINEST
\end{CodeVerbatim}

To open our tutorial file when starting the editor, execute the following command.  We will also set the logging level to INFO to tone down the chatter.  This will open the editor as a window similar to the screen shot in Figure~\ref{fig:editor-open}.
\begin{CodeVerbatim}[samepage=true,commandchars=\\\{\}]
$> cd $TUTORIAL/independence
$> java -cp $LTC/LTC-\version.jar \textbackslash
   com.sri.ltc.editor.LTCEditor -l INFO independence.tex
\end{CodeVerbatim}
\begin{figure}[t]
\centering
\mygraphics{width=\textwidth,height=.5\textheight,keepaspectratio}{figures/editor-open}
\caption{Initial opening of tutorial file in LTC Editor} \label{fig:editor-open}
\end{figure}
In this figure, we see a panel at the bottom-right that resembles the upper part of the gitx graphical interface to git.  There, we display the history of the .tex file of interest under git.  We can also see what git currently perceives as the current user -- John Adams because we had overridden the git settings in this repository.  (If you had another local git repository on your file system, the user information there is not changed.)

\section{Showing and Hiding Certain Changes}

The bottom-left panel of the editor allows us to customize the way LTC displays the changes of the file.  Section~\ref{sec:general-use} contains all the details of how LTC displays the changes including limiting the file history and filtering.  In this tutorial, we will just use some of the options and see their effect.

First, notice the list of known authors (as they are stored in the git repository) and the colors assigned to each of them.  Now perform a double-click on the colored square next to Roger Sherman to open a dialog and  choose a dark color such as brown (you will want something with contrast to the white background).  Notice how the text in the editor panel on the top changes color for those parts that are attributed to Roger Sherman's edits.

Next, focus on the typographical error in the command ``\textbackslash maketitle'' in line 11 and the beginning of the first paragraph in line thirteen.  If you uncheck the box for ``small'' changes and then the box for deletions, notice how the text in the editor panel is rendered.
\begin{figure}[t]
\centering
\mygraphics{width=.2\textwidth}{figures/editor-filter-small1}
\hspace{2ex}
\begin{tikzpicture}  \node [single arrow,draw] {hiding};
\end{tikzpicture}
\hspace{2ex}
\mygraphics{width=.2\textwidth}{figures/editor-filter-small2}
%\mygraphics{keepaspectratio}{figures/editor-filter-small}
\caption{Effect of hiding ``small'' changes and deletions} \label{fig:editor-filter-small}
\end{figure}
Figure~\ref{fig:editor-filter-small} shows that ``\textbackslash maketitle'' is no longer marked up, and the deletion of ``If'' at the beginning of the paragraph is now omitted.

\section{Understanding the Commit Graph}

Now draw your attention back to the graph with the history of the current file under git (located in the bottom-right panel).  In our example repository, this graph is just a line as the authors committed their versions in sequential order.  For the tutorial example, in which the writing project contained only one .tex file, the history graph in the LTC Editor looks almost the same as viewing the git repository in a graphical tool such as gitx.  However, if the writing project contained more .tex files, these graphs would not look similar anymore.  The git repository is tracking the history of all files that have been added to it.  In contrast, the LTC Editor only displays the history of the current .tex file loaded.

In addition to taking only commits with changes of the current file into account, the commit graph is traversed in a depth-first fashion to obtain one path from the current version of the file to some ancestor.  

After we have obtained an ordered list of commits, we ignore subsequent commits of the same author---only the latest version of the same author is considered.  The idea behind this is that we do not want to penalize an author who commits often to the repository.  Instead, we treat all his or her changes from the time the file was changed by a different author as one big change event.  In our example, see that Roger Sherman committed version 5 and 6 to the repository, but version 5 is depicted in gray and not taken into account when displaying the changes.  Refer to Figure~\ref{fig:commit-graph} for a screen shot of the example file history.
\begin{figure}[t]
\centering
\mygraphics{scale=.5}{figures/commit-graph}
\caption{Example of commit graph} \label{fig:commit-graph}
\end{figure}
Furthermore, notice that the first commit is also grayed out and not taken into account when displaying the changes.  The reason for this behavior is another default setting---we only go back until the next commit of the current author John Adams, which is the second version.  Here, we attempt to provide a reasonable general behavior for most cases, but this can be easily overridden by customizing the history view as explained below in Section~\ref{sec:limit-history}.

\section{Limiting History} \label{sec:limit-history}

We allow the user to filter and customize how the potentially rich history of a .tex file is compiled, so as to provide a better view of the tracked changes.  The user can show and hide changes as seen above, limit the authors of interest, and specify a date or revision number to tell LTC how far back in time the history should be considered.

\subsection{Limiting by Authors}

Select both authors Roger Sherman and Thomas Jefferson through clicking while holding down the CTRL or CMD key.  Then, click the button ``Limit,'' which will gray out the unselected authors.  For a limiting action to take effect, you need to click ``Update'' in contrast to showing and hiding changes, which is applied instantly.
\begin{figure}[t]
\centering
\mygraphics{width=\textwidth,height=.5\textheight,keepaspectratio}{figures/limit-authors}
\caption{Effect of limiting authors to Roger Sherman and Thomas Jefferson} \label{fig:limit-authors}
\end{figure}
Notice how most of the commit graph is now gray as only commits from the selected authors are considered.  Again, the history is only taken until the next revision of the current author, so that the first version is not included even though one of the selected authors has performed the commit.  Compare your editor window with the screen shot in Figure~\ref{fig:limit-authors} and see how the commit graph has changed.

Then, clicking the ``Reset'' button followed by ``Update'' will remove and limits on the history by author, so the original view is restored.

\subsection{Limiting by Date or Revision}

Next, we apply limits on how far back the history of the file is considered.  As we had seen, the first version is not taken into account because it was committed before the next commit by the current author John Adams.  Let us now type the first few characters \Code{6d6} of the SHA-1 key of the first commit into the field labeled ``Until Revision:'' or simply drag the key from the entry in the commit graph, which will copy the complete SHA-1 sequence.  Now click ``Update'' and see how the first version is listed in black and considered in the tracked changes above.  Since changes by the current author John Adams from the first to the second version are now included, notice the text marked up in red appearing in the screen shot in Figure~\ref{fig:limit-rev}.
\begin{figure}[t]
\centering
\mygraphics{width=\textwidth,height=.5\textheight,keepaspectratio}{figures/limit-rev}
\caption{Changing how far back history goes by revision} \label{fig:limit-rev}
\end{figure}
We see that John Adams must have added himself as an author in the LaTeX preamble among other edits.

To remove the limit by revision number, simply erase the text in the field ``Until Revision:'' and click ``Update'' again.

Limiting the history by date works similarly.  You may drag a date from the commit graph on the right, for example the date of the third version commit, and drop it into the field ``Until Date:'' on the left.  Or, type a date such as \Code{Jul 20, 2010} into the field.  Git tries to make sense of the input as a date or time string, and you do not need to follow the exact format shown in the commit graph.  Again, you will need to click ``Update'' for the change to take effect.  To remove the limit by date, erase all text in the text field and update.

\section{Editing, Saving, and Committing}

Let us start the next step by resetting all filters to the default configuration, i.e., no limit by authors, date, and revision.  Then, we will edit the text in the editor panel to see the latest changes.

Click into the text field and enter some text, for example a LaTeX comment reminding John Adams to work on a list of charges against King George III in line eighteen:
\begin{CodeVerbatim}
% list charges against King George III here
\end{CodeVerbatim}
The added text will be rendered in red (or the color code for the current author) and underlined.  Notice how the commit graph adds a first line with the label ``modified'' and the ``Save'' button becomes enabled.  Now delete some of the characters you have just entered, for example the word \Code{here} at the end.  The characters simply disappear as they were added by the same author.

Now delete other characters that are either rendered black or a different color than red.  Notice how these characters remain visible but are now colored red and marked up with strike-through.

Finally, you will want to click ``Save'' to save the current file to disk.  This will cause the label ``modified'' to change to ``on disk.''  If you would then again edit, the label would switch back to ``modified'' of course.

Saving the file, however, does not tell git to create a new version under its management.  In order to commit the current file to git, you have to give it a commit message such as \Code{added comment about list of charges} in the text field next to the ``Commit'' button.  Once the text field is not empty, the ``Commit'' button becomes enabled.  After you commit, the commit graph will list the new entry and the editor panel will be updated.  

But why is the newly added comment no longer marked up in red with underlining?  Check your settings for what to show and hide when tracking changes.  After updating the editor from the commit history, we actually perform some simple lexical analysis on the .tex file to distinguish preamble, commands, and comments in LaTeX.  Now the newly entered comment is recognized as such, and if we hide changes in comments, the markup will not show.  Check the box for ``changes in comments'' to see your latest text marked up as an addition.  Your editor should now look similar to the part shown in Figure~\ref{fig:commit-comment}.
\begin{figure}[t]
\centering
\mygraphics{width=\textwidth,height=.5\textheight,keepaspectratio}{figures/commit-comment}
\caption{Committing a comment and showing it as an addition} \label{fig:commit-comment}
\end{figure}

The ``Commit'' button is an interface to the underlying git version control management, but you can also interact with git directly from the command line.  You will want to make sure to have changes saved and the first line in the commit graph set to ``on disk.''  Then, from the command line in the \Code{\$TUTORIAL/independence} directory, you would call something similar to
\begin{CodeVerbatim}
$> git commit -o -m "first charge" -- independence.tex 
[master 0b52499] first charge
 1 files changed, 4 insertions(+), 0 deletions(-)
\end{CodeVerbatim}
Now update your editor window and see the addition of the commit from the command line to the commit graph as seen in Figure~\ref{fig:commit-cmd-line}.
\begin{figure}[t]
\centering
\mygraphics{scale=.5}{figures/commit-cmd-line}
\caption{Updated commit graph after command line commit} \label{fig:commit-cmd-line}
\end{figure}

\section{Collaborating}

Collaboration on your writing project mainly happens through git.  It depends on your setup how you exchange git repositories.  Whatever the configuration, it will probably show up under the list of registered remotes for your repository.  In the example, we cloned from the downloaded .bundle file, so looking at the remotes will look like this:
\begin{CodeVerbatim}
$> git remote -v
origin	$TUTORIAL/independence.bundle (fetch)
origin	$TUTORIAL/independence.bundle (push)
\end{CodeVerbatim}

If you need to declare a remote location to be used in your writing project, you can use a command similar to the following.  Make sure to replace all the relevant information about the \Code{alias} and \Code{URL} in this command.
\begin{CodeVerbatim}
$> git remote add alias user@server:path-to-git-repos/project.git
\end{CodeVerbatim}

As an example of interacting with another repository, let us create a second one on our local file system.  In practice, the remote repository will be on a different computer and accessed via certain network protocols reflected in the URL.  Feel free to adjust the file locations in the example below to your taste.
\begin{CodeVerbatim}
$> cd $TUTORIAL/independence
$> git clone . ~/independence.git
Cloning into ~/independence.git...
done.
$> git remote add philadelphia ~/independence.git
$> git remote -v
philadelphia	~/independence.git (fetch)
philadelphia	~/independence.git (push)
\end{CodeVerbatim}

Now, you can pull and push from and to the remote repository using its alias ``philadelphia'' with the following commands.  At this point, the two repositories are synched so the operations do not perform any changes.  These two commands are also available through the LTC Editor user interface---after choosing the remote from the pull-down menu in the lower-right corner, click the ``Pull'' or ``Push'' buttons.  If the menu is empty you may have to update the editor to obtain the latest git changes that you may have performed on the command line or using a graphical git tool.
\begin{CodeVerbatim}
$> git push philadelphia master
Everything up-to-date
$> $ git pull philadelphia master
From /Users/linda/git/independence
 * branch            master     -> FETCH_HEAD
Already up-to-date.
\end{CodeVerbatim}

% TODO: create example that shows branches in commit graph => independence2.bundle?

%\subsection{Resolving Merge Conflicts}

\section{Using Emacs with Example Git Repository}

% TODO: screen shots
